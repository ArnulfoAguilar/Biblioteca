CREATE OR REPLACE FUNCTION FUN_AGREGAR_COPIAS()
RETURNS TRIGGER AS $BODY$
DECLARE
--CODIGO_BARRA  TEXT := NEW."ISBN" || lpad(NEW."PAGINAS"::char ,6,'0');
BEGIN
	FOR i IN 1 .. NEW."COPIAS" LOOP
		INSERT INTO public.libros("CODIGO_BARRA", "ID_EJEMPLAR", "PAGINAS") 
		VALUES(NEW."ISBN" || lpad(i::char ,3,'0'), NEW.ID, NEW."PAGINAS"); 
	END LOOP;
RETURN NEW;
END $BODY$
LANGUAGE PLPGSQL;

DROP TRIGGER IF EXISTS TR_AGREGAR_COPIA ON public."Ejemplar";

CREATE TRIGGER TR_AGREGAR_COPIA
AFTER INSERT ON public."Ejemplar"
FOR EACH ROW 
EXECUTE PROCEDURE FUN_AGREGAR_COPIAS();